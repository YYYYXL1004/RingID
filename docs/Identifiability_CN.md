# 可识别性分析 (Identifiability Analysis)

## 1. 引言

### 1.1 问题背景
传统的 Tree-Ring 水印技术只能回答一个简单的问题："这张图片是否包含水印？"（二分类问题）。然而，在实际的商业场景中，我们需要解决一个更复杂的问题："这张图片是由哪个供应商生成的？"（多分类问题）。

### 1.2 应用场景
- **版权追溯**：当发现侵权图片时，需要识别其来源
- **多供应商管理**：云服务商需要区分不同客户生成的内容
- **责任认定**：在法律纠纷中确定图片的生成者

### 1.3 研究目标
本节评估 RingID 在多密钥（Multi-Key）场景下的识别能力，验证其能否准确区分不同供应商的水印。

---

## 2. 方法

### 2.1 RingID 多密钥机制
RingID 通过在傅里叶频域的不同"环"上注入不同的值来实现多密钥区分：

- **水印区域**：半径 3-14 的圆环区域（共 11 个环）
- **密钥编码**：每个环可以取不同的值，不同的值组合代表不同的密钥
- **理论容量**：$K^{11}$ 个不同的密钥（$K$ 为每个环可取的值数量）

### 2.2 实验设置

| 参数 | 值 |
|------|-----|
| 密钥数量 | 5 个（模拟 5 家供应商） |
| 每个密钥图片数 | 20 张 |
| 总图片数 | 100 张 |
| 图像分辨率 | 512 × 512 |
| 推理步数 | 50 |
| Prompt 来源 | Stable-Diffusion-Prompts 数据集 |

### 2.3 评估指标

**识别准确率 (Identification Accuracy)**：
$$\text{Acc} = \frac{\text{正确识别的图片数}}{\text{总图片数}}$$

**混淆矩阵 (Confusion Matrix)**：
- 行：真实密钥
- 列：预测密钥
- 对角线：正确识别
- 非对角线：误识别

---

## 3. 实验结果

### 3.1 识别准确率

| 攻击类型 | 准确率 |
|----------|--------|
| 无攻击 (Clean) | 100.0% |
| 旋转 75° | 100.0% |
| JPEG 压缩 25% | 100.0% |
| 裁剪缩放 75% | 86.0% |
| 高斯模糊 (r=8) | 99.0% |
| 高斯噪声 (σ=0.1) | 99.0% |
| 亮度调整 | 100.0% |
| **平均** | **97.7%** |

### 3.2 混淆矩阵

```
          预测密钥
          K0    K1    K2    K3    K4
真实 K0  [95%,   5%,   0%,   0%,   0%]
     K1  [ 5%,  95%,   0%,   0%,   0%]
     K2  [ 5%,   0%,  95%,   0%,   0%]
     K3  [ 5%,   0%,   0%,  95%,   0%]
     K4  [ 5%,   0%,   0%,   0%,  95%]
```

### 3.3 混淆矩阵热力图

![混淆矩阵热力图](../runs/2026_01_12_22_38_37_multi_key_5vendors/confusion_matrix.png)

---

## 4. 分析与讨论

### 4.1 密钥正交性分析
- 对角线元素占比：95%（正确识别率）
- 非对角线元素占比：5%（误识别率）
- 最大误识别对：所有 Key → Key 0（5%）

### 4.2 攻击鲁棒性分析
- **最鲁棒**：Clean / 旋转 / JPEG / 亮度（准确率 100%）
- **最脆弱**：裁剪缩放 C&S 75%（准确率 86%）
- **原因分析**：裁剪缩放会破坏傅里叶频域中的环形结构，导致部分水印信息丢失

### 4.3 与 Tree-Ring 的对比

| 特性 | Tree-Ring | RingID |
|------|-----------|--------|
| 任务类型 | 二分类（有/无水印） | 多分类（识别供应商） |
| 密钥容量 | 1 | $K^{11}$ |
| 识别准确率 | N/A | 97.7% |

---

## 5. 结论

1. RingID 能够有效区分 5 个不同的供应商密钥，平均识别准确率达到 **97.7%**
2. 在大多数攻击场景下，识别准确率保持在 **86%** 以上
3. 密钥之间具有良好的正交性，误识别率低于 **5%**
4. RingID 解决了 Tree-Ring 无法进行多供应商识别的局限性

---

## 附录：实验命令

```bash
python identify.py \
    --run_name multi_key_5vendors \
    --trials 100 \
    --assigned_keys 5 \
    --reference_model None \
    --save_generated_imgs 1
```
