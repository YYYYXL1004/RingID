# RingID é¢‘æ®µè§£è€¦å®éªŒ

> åŸºäº [RingID](http://arxiv.org/abs/2404.14055) çš„å¤šä¾›åº”å•†è¯†åˆ«åœºæ™¯ä¸‹é¢‘æ®µç­–ç•¥éªŒè¯å®éªŒ

## é¡¹ç›®èƒŒæ™¯

æœ¬é¡¹ç›®æ˜¯**æˆå‘˜ B** çš„å®éªŒä»£ç ï¼Œç”¨äºï¼š
1. éªŒè¯æˆå‘˜ A åœ¨ Tree-Ring ä¸Šå‘ç°çš„**åŒé¢‘å¸¦ç­–ç•¥**åœ¨ RingID å¤šä¾›åº”å•†è¯†åˆ«åœºæ™¯ä¸‹æ˜¯å¦åŒæ ·æœ‰æ•ˆ
2. æ¢ç´¢å¯†é’¥å®¹é‡æé™
3. æ¢ç´¢ PAI è·¯å¾„åè½¬åœ¨å¤šå¯†é’¥è¯†åˆ«åœºæ™¯ä¸‹çš„æ•ˆæœ

| é˜¶æ®µ | è´Ÿè´£äºº | ç ”ç©¶å†…å®¹ | åœºæ™¯ |
|------|--------|----------|------|
| å‡è®¾æå‡º | æˆå‘˜ A | åŒé¢‘å¸¦ç­–ç•¥ + PAI åè½¬ | Tree-Ring (å•å¯†é’¥éªŒè¯) |
| **å‡è®¾éªŒè¯** | **æˆå‘˜ B** | åŒé¢‘å¸¦éªŒè¯ + å®¹é‡æ¢ç´¢ + åè½¬æ¢ç´¢ | **RingID (å¤šå¯†é’¥è¯†åˆ«)** |

## æ ¸å¿ƒå®éªŒç»“æœ

### 1. é¢‘æ®µç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | Clean | C&S75 | å¹³å‡å‡†ç¡®ç‡ |
|------|-------|-------|------------|
| ä½é¢‘ (R=3-7) | 100% | 88% | 97.7% |
| é«˜é¢‘ (R=8-14) | 100% | 80% | 96.6% |
| **åŒé¢‘å¸¦ (R=3-14)** | 100% | **90%** | **98.3%** âœ“ |

**ç»“è®º**ï¼šåŒé¢‘å¸¦ç­–ç•¥åœ¨å¤šä¾›åº”å•†è¯†åˆ«åœºæ™¯ä¸‹**åŒæ ·è¡¨ç°æœ€ä¼˜**ï¼ŒéªŒè¯äº†å…¶æ™®é€‚æ€§ã€‚

### 2. å¯†é’¥å®¹é‡æµ‹è¯•

| å¯†é’¥æ•° | å¹³å‡å‡†ç¡®ç‡ | C&S75 |
|--------|------------|-------|
| 5 | 98.3% | 90% |
| 10 | 96.4% | 78% |
| 20 | 95.4% | 71% |
| 30 | 93.4% | 58% |
| 50 | 91.7% | 48% |

**ç»“è®º**ï¼šå®ç”¨å¯†é’¥å®¹é‡ä¸º **20-30** ä¸ªã€‚

### 3. PAI è·¯å¾„åè½¬æ¢ç´¢ ğŸ†•

| é…ç½® | C&S75 | å¹³å‡å‡†ç¡®ç‡ |
|------|-------|------------|
| **Baseline (æ— åè½¬)** | **90%** | **98.3%** |
| åè½¬ (s=5, m=0.1) | 84% | 97.4% |

**å…³é”®å‘ç°**ï¼šåœ¨å¤šå¯†é’¥è¯†åˆ«åœºæ™¯ä¸‹ï¼Œè·¯å¾„åè½¬ï¼ˆæŠ—ç¯¡æ”¹å¢å¼ºï¼‰ä¸è¯†åˆ«å‡†ç¡®ç‡å­˜åœ¨ **trade-off**ã€‚

| åœºæ™¯ | åè½¬æ•ˆæœ |
|------|----------|
| A: å•å¯†é’¥éªŒè¯ | âœ… æœ‰ç›Šï¼ˆå¢å¼ºæŠ—ç¯¡æ”¹ï¼‰ |
| B: å¤šå¯†é’¥è¯†åˆ« | âŒ æ— ç›Šï¼ˆé™ä½å‡†ç¡®ç‡ï¼‰ |

## ç¯å¢ƒé…ç½®

```bash
conda activate tr
```

**ä¾èµ–ç‰ˆæœ¬**ï¼š
- PyTorch >= 1.13.0
- diffusers == 0.11.1
- transformers == 4.23.1

## ä½¿ç”¨æ–¹æ³•

### å¤šå¯†é’¥è¯†åˆ«å®éªŒ
```bash
python identify.py --run_name test --trials 50 --assigned_keys 5 --gpu_id 3
```

### é¢‘æ®µé€‰æ‹©å¯¹æ¯”å®éªŒ
```bash
python scripts/frequency_band_test.py --gpu 3
```

### å¯†é’¥å®¹é‡æµ‹è¯•
```bash
python scripts/key_capacity_test.py --keys 5,10,20,30,50 --gpu 3
```

### PAI è·¯å¾„åè½¬å®éªŒ
```bash
# Baseline
python identify.py --use_deflection 0 --assigned_keys 5 --trials 100 --gpu_id 3

# åè½¬å®éªŒ
python identify.py --use_deflection 1 --deflection_steps 5 --deflection_strength 0.1 --assigned_keys 5 --trials 100 --gpu_id 3
```

## é¡¹ç›®ç»“æ„

```
RingID/
â”œâ”€â”€ identify.py                 # ä¸»ç¨‹åºï¼šå¤šå¯†é’¥è¯†åˆ«
â”œâ”€â”€ utils.py                    # æ ¸å¿ƒå·¥å…·å‡½æ•°
â”œâ”€â”€ inverse_stable_diffusion.py # DDIM é€†å‘
â”œâ”€â”€ modified_stable_diffusion.py# ä¿®æ”¹ç‰ˆ SD pipeline
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ frequency_band_test.py  # é¢‘æ®µå¯¹æ¯”å®éªŒ
â”‚   â”œâ”€â”€ key_capacity_test.py    # å¯†é’¥å®¹é‡æµ‹è¯•
â”‚   â”œâ”€â”€ run_deflection_experiments.sh  # PAI åè½¬å®éªŒæ‰¹é‡è„šæœ¬
â”‚   â””â”€â”€ generate_confusion_matrix.py
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ Identifiability_CN.md   # ä¸­æ–‡æŠ¥å‘Š
â”‚   â””â”€â”€ Identifiability_EN.md   # è‹±æ–‡æŠ¥å‘Š
â”œâ”€â”€ runs/                       # å®éªŒç»“æœ
â”œâ”€â”€ models/                     # SD æ¨¡å‹
â””â”€â”€ sd_prompts_dataset/         # Prompt æ•°æ®é›†
```

## æ–‡æ¡£

- [ä¸­æ–‡æŠ¥å‘Š](docs/Identifiability_CN.md)
- [English Report](docs/Identifiability_EN.md)

## å‚è€ƒ

- [RingID Paper](http://arxiv.org/abs/2404.14055)
- [Tree-Ring Watermark](https://github.com/YuxinWenRick/tree-ring-watermark)
- [PAI Paper](https://arxiv.org/abs/2601.06639) - Path-Aware Injection for Watermark


